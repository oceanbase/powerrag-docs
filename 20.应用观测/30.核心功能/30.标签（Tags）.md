# 标签（Tags）

标签（Tag） 用于对 Trace 进行分类和筛选。在 PowerRAG 中，您可以通过以下两种方式为 Trace 添加标签：

1. 在创建 Trace 时，通过 PowerRAG SDK 或相关集成接口直接添加；
2. 在控制台（UI）中，为已存在的 Trace 添加标签。

要为 Trace 添加标签，只需在 Trace 对象的 tags 字段中传入一个字符串数组即可。每个标签都是一个字符串，且同一个 Trace 可以包含多个标签。目前标签只可新增，不可删除。

## 使用方法
### Python SDK
+ 使用 @observe() 装饰器

```python
from langfuse import observe, get_client

langfuse = get_client()

@observe()
def my_function():
    # ... 业务逻辑处理 ...
    # 为当前 Trace 添加标签
    langfuse.update_current_trace(tags=["tag-1", "tag-2"])
```

+ 直接创建 Span 或 Generation

```python
from langfuse import get_client
langfuse = get_client()

# 在创建根 span 时添加标签
with langfuse.start_as_current_span(name="my-operation") as root_span:
    # 为当前 Trace 添加标签
    root_span.update_trace(tags=["tag-1", "tag-2"])

    # 在同一 Trace 的任意 span 中可继续添加标签
    with root_span.start_as_current_generation(name="llm-call", model="gpt-4o") as gen:
        # 处理逻辑...
        gen.update_trace(tags=["llm-gen"])  # 为同一 Trace 添加额外标签
```

+ 无需直接引用 Span 的方式更新标签

```python
with langfuse.start_as_current_span(name="another-operation"):
    # ... 处理逻辑 ...
    langfuse.update_current_trace(tags=["processing", "beta-feature"])
```

### JS/TS SDK
+ 使用上下文管理器

```typescript
import {
  startActiveObservation,
  startObservation,
  updateActiveTrace,
} from "@langfuse/tracing";

await startActiveObservation("context-manager", async (span) => {
  span.update({
    input: { query: "What is the capital of France?" },
  });

  updateActiveTrace({
    tags: ["tag-1", "tag-2"],
  });
});
```

+ 使用 observe 包装器

```typescript
import { observe, updateActiveTrace } from "@langfuse/tracing";

// 已有函数
async function fetchData(source: string) {
  updateActiveTrace({
    tags: ["tag-1", "tag-2"],
  });

  // ... 获取数据逻辑 ...
  return { data: `some data from ${source}` };
}

// 使用 observe 包装函数
const tracedFetchData = observe(fetchData, {
  name: "observe-wrapper",
});

const result = await tracedFetchData("API");
```

+ 手动创建 Span

```typescript
import { startObservation } from "@langfuse/tracing";

const span = startObservation("manual-observation", {
  input: { query: "What is the capital of France?" },
});

span.updateTrace({
  tags: ["tag-1", "tag-2"],
});

span.update({ output: "Paris" }).end();
```

## 使用场景
标签是一种灵活的元数据机制，可帮助您更好地组织与分析 Trace 数据。在设计标签体系时，建议根据实际的监控与分析需求，选择能体现业务语义或环境特征的标签。

常见的标签用法包括：

+ 版本区分：标识不同版本的应用，例如 app-v1、app-v2；
+ 模型策略：标识使用的 LLM 策略，例如 rag、one-shot、few-shot；
+ 环境信息：标识应用运行环境，例如 local、staging、prod；
+ 业务模块：标识业务功能或模块，例如 chat、retrieval、evaluation。

通过合理设置标签，您可以在 PowerRAG 控制台中轻松地筛选 Trace、分析性能指标、或对比不同模型/版本的表现。

