# 消息占位符

消息占位符允许您在聊天提示词中的特定位置插入聊天消息列表（`[{role: "...", content: "..."}]`）。

您可以在提示词中定义多个占位符，并在运行时使用不同的值解析它们。[Playground](30.Playground.md) 和 [数据集跑测](../../40.应用评估/20.跑测/30.通过控制台跑测.md) 也支持消息占位符。

## 用占位符创建提示词
### 使用控制台
1. 进入提示词编辑界面。
    - 创建提示词：在导航栏选择 **提示词**，单击页面右上角 **+提示词**。
    - 更新提示词：在导航栏选择 **提示词**，单击已创建的提示词名称，单击 **+New**。
2. 提示词类型选择 **聊天**。 
3. 单击 **+占位符**。
4. 输入占位符的名称，例如，`chat_history`，用于在应用中引用它。

### 使用 Python SDK
```plain
from langfuse import get_client
 
langfuse = get_client()
 
langfuse.create_prompt(
    name="movie-critic-chat",
    type="chat",
    prompt=[
      { "role": "system", "content": "You are an {{criticlevel}} movie critic" },
      { "type": "placeholder", "name": "chat_history" }, 
      { "role": "user", "content": "What should I watch next?" },
    ],
    labels=["production"],  # 直接推到生产环境
)
```

### 使用 JS/TS SDK
```python
import { LangfuseClient } from "@langfuse/client";
 
const langfuse = new LangfuseClient();
 
await langfuse.prompt.create({
  name: "movie-critic-chat",
  type: "chat",
  prompt: [
    { role: "system", content: "You are an {{criticlevel}} movie critic" },
    { type: "placeholder", name: "chat_history" },
    { role: "user", content: "What should I watch next?" },
  ],
  labels: ["production"], // 直接推到生产环境
});
```



## 在运行时解析占位符
在 SDK 中，在`ChatPromptClient`使用`.compile(variables, placeholders)`方法来设置占位符需要填写的值。填写的消息应采用`ChatMessage`格式，带有`role`和`content`属性，但也接受自定义格式，因为`compile`方法不验证消息的格式。

### 使用 Python SDK
```python
from langfuse import get_client

langfuse = get_client()

# 在您的应用中使用带占位符的提示词
prompt = langfuse.get_prompt("movie-critic-chat")

# 编译变量并用消息列表解析占位符
compiled_prompt = prompt.compile(criticlevel="expert", chat_history=[
    {"role": "user", "content": "I love Ron Fricke movies like Baraka"},
    {"role": "user", "content": "Also, the Korean movie Memories of a Murderer"}
])

# -> compiled_prompt = [
#   { "role": "system", "content": "You are an expert movie critic" },
#   { "role": "user", "content": "I love Ron Fricke movies like Baraka" },
#   { "role": "user", "content": "Also, the Korean movie Memories of a Murderer" },
#   { "role": "user", "content": "What should I watch next?" },
# ]
```

### 使用 JS/TS SDK
```python
import { LangfuseClient } from "@langfuse/client";
 
const langfuse = new LangfuseClient();
 
const prompt = await langfuse.prompt.get("movie-critic-chat", {
  type: "chat",
});
 
// 编译变量并用消息列表解析占位符
const compiledPrompt = prompt.compile(
  // 变量
  { criticlevel: "expert" },
  // 占位符
  {
    chat_history: [
      { role: "user", content: "I love Ron Fricke movies like Baraka" },
      {
        role: "user",
        content: "Also, the Korean movie Memories of a Murderer",
      },
    ],
  }
);
 
// -> compiledPrompt = [
//   { role: "system", content: "You are an expert movie critic" },
//   { role: "user", content: "I love Ron Fricke movies like Baraka" },
//   { role: "user", content: "Also, the Korean movie Memories of a Murderer" },
//   { role: "user", content: "What should I watch next?" },
// ]
```

  
 

