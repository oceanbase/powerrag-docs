# User tracking

User tracking helps you analyze application usage from both global and individual user perspectives. In PowerRAG, you can associate traces with specific users by passing a unique user identifier `userId` when creating a trace. All traces containing the same `userId` are automatically grouped under the same user. The `userId` can be a username, email, or any string that uniquely identifies a user. This parameter is optional but recommended to obtain more granular observability data.

## How to use

### Python SDK

+ Using the @observe() decorator

```python
from langfuse import observe, get_client

langfuse = get_client()

@observe()
def process_user_request(user_query):
    # Add user_id to current trace
    langfuse.update_current_trace(user_id="user_12345")

    # ... processing logic ...
    return result
```

+ Directly creating a span

```python
from langfuse import get_client

langfuse = get_client()

# Set user_id via update_trace when creating root span
with langfuse.start_as_current_span(
    name="process-user-request"
) as root_span:
    # Add user_id to trace
    root_span.update_trace(user_id="user_12345")

    # All spans under this trace will be associated with this user
    with root_span.start_as_current_generation(
        name="generate-response",
        model="gpt-4o"
    ) as gen:
        # ... generate response ...
        pass
```

+ Updating user information without direct span reference

```python
with langfuse.start_as_current_span(name="handle-user-interaction"):
    # Add user_id to current trace
    langfuse.update_current_trace(user_id="user_12345")
```

### JS/TS SDK

+ Using context managers

```typescript
import {
  startActiveObservation,
  startObservation,
  updateActiveTrace,
} from "@langfuse/tracing";

await startActiveObservation("context-manager", async (span) => {
  span.update({
    input: { query: "What is the capital of France?" },
  });

  // Set userId for trace
  updateActiveTrace({
    userId: "user-123",
  });
});
```

+ Using observe wrapper function

```typescript
import { observe, updateActiveTrace } from "@langfuse/tracing";

// Original function
async function fetchData(source: string) {
  // Set userId for trace
  updateActiveTrace({
    userId: "user-123",
  });

  // ... data fetching logic ...
  return { data: `some data from ${source}` };
}

// Use observe wrapper to enable tracing
const tracedFetchData = observe(fetchData, {
  name: "observe-wrapper",
});

const result = await tracedFetchData("API");
```

+ Manually creating a span

```typescript
import { startObservation } from "@langfuse/tracing";

const span = startObservation("manual-observation", {
  input: { query: "What is the capital of France?" },
});

// Set userId for trace
span.updateTrace({
  userId: "user-123",
});

span.update({ output: "Paris" }).end();
```

## View all users

The user list view displays all tracked users. You can filter and analyze by overall token usage, trace count, and user feedback.

## View individual user

The individual user view provides more granular analysis capabilities. You can view the user's aggregated metrics, all trace records, and their feedback information, helping you understand model performance across different user scenarios.

