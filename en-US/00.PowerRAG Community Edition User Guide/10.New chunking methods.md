# New chunking methods

PowerRAG introduces three more flexible chunking methods on top of RAGFlow's original chunking mechanism: **Title Chunking**, **Regex Chunking**, and **Smart Chunking**.

These chunking methods can be used during document import and parsing to control the granularity of document blocks, improving the accuracy of knowledge retrieval and question-answering. While RAGFlow's native chunking strategies meet most requirements, for documents with complex hierarchical structures, inconsistent formats, or multiple content types such as code and tables, the three extended chunking methods provided by PowerRAG can achieve higher semantic integrity and structural control.

For information about chunking strategies natively supported by RAGFlow, please refer to the [RAGFlow official documentation](https://ragflow.io/docs/v0.22.0/select_pdf_parser).

## How to access

* For new knowledge bases, you can set the chunking method when creating the knowledge base.

* For existing knowledge bases, you can modify the chunking method in the configuration.

## Title chunking

### Description

**Title chunking** is a strategy that splits content based on document heading levels. The system divides content into independent chapter blocks according to the heading hierarchy in Markdown or other document formats. Each block starts from a heading and ends when encountering the next heading of the same or higher level.

This method ensures that each chunk represents a logically complete chapter, suitable for scenarios where chapter content needs to be retrieved or displayed independently.

Title chunking supports DOCX, DOC, PDF, Markdown, and HTML document formats.

### Use cases

* **Technical documentation, product manuals, or normative documents**: Suitable for long-form technical documents, user manuals, or product specification documents that require logical segmentation by chapters, enabling clear content block division based on heading levels for structured presentation and navigation.
* **Long documents with clear hierarchical structures**: For long documents with distinct hierarchies and rich content (such as standards, guidelines, etc.), title chunking ensures that each chapter or subchapter maintains independence, facilitating user reference and navigation.
* **Knowledge bases requiring directory or chapter-level navigation**: If documents need to support directory-style navigation or chapter-level retrieval (such as online documentation libraries, knowledge management systems, etc.), title chunking provides clear segmentation structures, improving retrieval efficiency.
* **Documents requiring preservation of title-content relationships**: Suitable for cases where each heading in a document is closely related to its content. title chunking ensures that each chunk maintains complete context while preserving heading hierarchy information.

### How to configure

When creating a knowledge base or importing documents, select `Title` as the chunking method, and configure the segmentation level through the following parameters:

* **Heading Level**: Select the maximum heading level (H1-H6) used for document segmentation. Higher levels include all lower levels.
* **Text Segmentation Delimiter**: Text segmentation delimiter, supports multi-character separators, wrapped in double backticks (``).

### Example

**Input Document:**

```plain
# System Overview
The system adopts a distributed architecture.

## Core Components
Includes storage engine, scheduling module, and compute nodes.

## Deployment Methods
Can be deployed via containers or physical machines.
```

**Configuration:**

Heading level is set to 2.

**Output Chunks:**

* Chunk 1:

    ```plain
    # System Overview
    The system adopts a distributed architecture.
    ```

* Chunk 2:

    ```plain
    ## Core Components
    Includes storage engine, scheduling module, and compute nodes.

    ## Deployment Methods
    Can be deployed via containers or physical machines.
    ```

## Regex chunking

### Description

**Regex chunking** allows users to define delimiters using custom regular expressions, providing flexible control over document segmentation rules. This method does not rely on document structure analysis and is suitable for processing non-standard format files or log-type data.

Regex chunking supports DOCX, DOC, PDF, Markdown, and HTML document formats.

### Use cases

* **Contracts or policy documents segmented by numbers, dates, or key symbols**: Regex Chunking is suitable for contract files, policy documents, etc., that need to be segmented according to specific numbers, dates, or symbols (such as clause numbers, date markers, etc.), helping to efficiently split according to specific formats or rules.
* **Log files or time-series records**: For log files, event records, or time-series data, regex chunking can split documents according to preset patterns (such as timestamps, event identifiers, etc.), effectively processing and categorizing these continuous record data.
* **Batch data files or exported reports**: Suitable for batch-generated or exported reports and data files, which typically contain uniform formats or structures. regex chunking can quickly split data blocks according to specific symbols or format rules in the files.
* **Plain text with custom formats**: When document formats are not fixed and structures are diverse, regex chunking can flexibly segment according to user-defined regular expressions, processing various non-standard format text files, such as log files, configuration files, etc.
* **Documents requiring information extraction based on specific patterns**: If text blocks need to be extracted according to specific keywords, formats, or symbols (such as email records, annotations, scripts, etc.), regex chunking can help extract key information from structurally complex documents and perform segmentation.

### How to configure

When creating a knowledge base, select `Regex` as the chunking method and configure it through the following parameters:

* **Regular Expression Pattern**: A regular expression used to initially segment text units. This pattern defines how to split text into units before chunking. For example, `"[.!?]+\s*"` matches sentence endings.
* **Text Segmentation Delimiter**: Split chunks by specified characters. Multiple characters can be specified, such as line breaks, periods, semicolons, etc.

> **Note**  
> The system first segments text according to the **Regular Expression Pattern** to obtain initial units. If units are too large, they are further split according to the **Text Segmentation Delimiter** to avoid generating overly long chunks.

### Example

**Input Document:**

```plain
1. Project Background
This project aims to establish a unified monitoring system.

2. System Requirements
The system needs to support multi-tenancy, disaster recovery, and high availability.

3. Implementation Plan
Phase one deploys core nodes, phase two expands storage capacity.
```

**Configuration:**

* Regular Expression Pattern: `[.!?]+\s*`
* Text Segmentation Delimiter: `\n。.；;！!？？`

**Output Chunks:**

* Chunk 1:

    ```plain
    1. Project Background
    This project aims to establish a unified monitoring system.
    ```

* Chunk 2:

    ```plain
    2. System Requirements
    The system needs to support multi-tenancy, disaster recovery, and high availability.
    ```

* Chunk 3:

    ```plain
    3. Implementation Plan
    Phase one deploys core nodes, phase two expands storage capacity.
    ```

## Smart chunking

### Description

**Smart chunking** automatically identifies paragraphs, lists, tables, code blocks, and other content based on the semantic structure of documents, controlling chunk size while maintaining semantic integrity. Compared to title chunking, smart chunking not only considers heading structure but also comprehensively evaluates document layout features and logical relationships, achieving more natural semantic segmentation.

Smart chunking supports DOCX, DOC, PDF, Markdown, and HTML document formats.

#### How it works

1. The system uses headings as primary delimiters to divide documents into hierarchically structured content blocks. Each chunk retains its heading and parent heading information for subsequent context tracing and semantic association.
2. The system identifies paragraphs, lists, tables, code blocks, and quote blocks in documents, and performs intelligent merging and splitting based on semantic units. For tables and code blocks, even if their length exceeds the recommended chunk size, they will not be further split to ensure content integrity.
3. At the semantic level, the system comprehensively evaluates text relevance and logical boundaries, outputting chunks that maintain contextual continuity and semantic completeness.

### Use cases

* **Technical documents containing multiple elements (paragraphs, tables, code)**: Suitable for technical documents that need semantic segmentation, especially when documents contain multiple elements (such as paragraphs, tables, code blocks, etc.).
* **Documents with standardized heading hierarchies**: smart chunking uses heading hierarchy structures in documents for segmentation, making it more suitable for Markdown format documents (such as `.md` files). Documents with standardized heading hierarchies can better leverage the advantages of this chunking strategy.
* **Knowledge bases requiring both semantic integrity and retrieval precision**: Suitable for knowledge bases that require precise semantic segmentation while preserving document logical relationships.
* **General choice for initial document import**: smart chunking is a general choice suitable for initial document import, especially when document structures are not standardized, as it can automatically supplement semantic-level segmentation.

### Example

**Input Document:**

```plain
## System Components
The system consists of the following modules:
- Data Collection Module
- Task Scheduling Module
- Log Analysis Module

| Module | Description |
|------|------|
| Data Collection Module | Responsible for reading data from external sources |
| Log Analysis Module | Provides log statistics and visualization |
```

**Output Chunks:**

* Chunk 1:

    ```plain
    ## System Components
    The system consists of the following modules:
    - Data Collection Module
    - Task Scheduling Module
    - Log Analysis Module
    ```

* Chunk 2:

    ```plain
    | Module | Description |
    |------|------|
    | Data Collection Module | Responsible for reading data from external sources |
    | Log Analysis Module | Provides log statistics and visualization |
    ```

**Smart chunking processing:**

1. **Heading Segmentation**: First, the system uses `## System Components` as the primary delimiter for segmentation, so the document will be divided into two parts: the heading and its following content.
2. **Content Merging**: In this example, elements such as paragraphs, lists, and tables are merged into a complete semantic unit to maintain content logical continuity.
3. **Tables and Code Blocks**: The table section is treated as an independent unit due to its non-splittable content. Even if it exceeds the recommended chunk size, it will not be split.

Chunk 1 contains the heading `## System Components` and the paragraph and list content immediately following it. The heading and content are treated as one logical unit, maintaining contextual completeness. Chunk 2's table section is treated as a separate chunk because it cannot be split. Even if the table content exceeds the recommended chunk size, it will not be split into smaller parts.

