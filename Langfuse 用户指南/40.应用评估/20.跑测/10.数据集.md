# 数据集

数据集是输入和预期输出的集合，用于测试您的应用。基于控制台和 SDK 的跑测均支持 Langfuse 数据集。

Langfuse 数据集视图：

![](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/powerrag/langfuse/dataset.png)

## 为什么使用数据集？
+ 使用真实的生产环境跟踪为您的应用创建测试用例。
+ 与您的团队协作创建和收集数据集项目。
+ 为测试数据提供单一真实来源。

## 使用流程
### 创建数据集
数据集在项目中具有唯一的名称。

#### 使用 Python SDK
```python
langfuse.create_dataset(
    name="<dataset_name>",
    # 描述，可选
    description="My first dataset",
    # 元数据，可选
    metadata={
        "author": "Alice",
        "date": "2022-01-01",
        "type": "benchmark"
    }
)
```

#### 使用 JS/TS SDK
```python
import { LangfuseClient } from "@langfuse/client"
 
const langfuse = new LangfuseClient()
 
await langfuse.api.datasets.create({
  name: "<dataset_name>",
  // 描述，可选
  description: "My first dataset",
  // 元数据，可选
  metadata: {
    author: "Alice",
    date: "2022-01-01",
    type: "benchmark",
  },
});
```

#### 使用控制台
1. 从导航栏选择 **数据集**。
2. 单击页面右上角 **+新建数据集**。
3. 在弹窗中输入数据集名称、描述、元数据。
4. 单击 **创建数据集**。

### 上传或创建新的数据集项目
#### 使用 Python SDK
```python
langfuse.create_dataset_item(
    dataset_name="<dataset_name>",
    # 任何 python 对象或值，可选
    input={
        "text": "hello world"
    },
    # 任何 python 对象或值，可选
    expected_output={
        "text": "hello world"
    },
    # 元数据，可选
    metadata={
        "model": "llama3",
    }
)
```

#### 使用 JS/TS SDK
```python
import { LangfuseClient } from "@langfuse/client";
 
const langfuse = new LangfuseClient();
 
await langfuse.api.datasetItems.create({
  datasetName: "<dataset_name>",
  // 任何 JS 对象或值
  input: {
    text: "hello world",
  },
  // 任何 JS 对象或值，可选
  expectedOutput: {
    text: "hello world",
  },
  // metadata, optional
  metadata: {
    model: "llama3",
  },
});
```

#### 使用控制台
在控制台上传或创建新的数据集项目有三种方法。

##### 添加项目
1. 在数据集详情页面，选择** 项目 **页签，进入数据集项目列表。
2. 单击页面右上角 **+新建项目**。
3. 在弹窗中选择数据集，输入项目的输入、预期输出、元数据。
4. 单击 **添加到数据集**。

##### 导入CSV
1. 准备好包含数据集项目输入、预期输出、元数据的 CSV 文件。
2. 在数据集详情页面，选择** 项目 **页签。
3. 单击页面右上角 **+上传 CSV**。
4. 在弹窗中选择 CSV 文件进行添加。

##### 从跟踪添加
1. 从导航栏选择 **跟踪**，单击跟踪名称，进入跟踪详情页面。
2. 单击页面右上角 **添加到数据集**。
3. 在弹窗中选择数据集，可根据需求编辑项目的输入、预期输出、元数据。
4. 单击 **添加到数据集**。

## 根据生产数据创建项目
常见的工作流程是，选择应用未按预期运行的生产环境跟踪。然后，让专家添加预期输出，以便在相同数据上测试应用的新版本。

### 使用 Python SDK
```python
langfuse.create_dataset_item(
    dataset_name="<dataset_name>",
    input={ "text": "hello world" },
    expected_output={ "text": "hello world" },
    # 连接到 trace
    source_trace_id="<trace_id>",
    # 可选：连接到特定 span、event 或 generation
    source_observation_id="<observation_id>"
)
```

### 使用 JS/TS SDK
```python
import { LangfuseClient } from "@langfuse/client";
 
const langfuse = new LangfuseClient();
 
await langfuse.api.datasetItems.create({
  datasetName: "<dataset_name>",
  input: { text: "hello world" },
  expectedOutput: { text: "hello world" },
  // 连接到一个跟踪
  sourceTraceId: "<trace_id>",
  // 可选：连接到特定 span、event 或 generation
  sourceObservationId: "<observation_id>",
});
```

### 使用控制台
将生产环境跟踪的任何观测 （span、event 或 generation）加入数据集。

1. 从导航栏选择 **跟踪**，单击跟踪名称进入跟踪详情页面。
2. 单击页面右上角 **添加到数据集**。
3. 在弹窗中选择数据集，可根据需求编辑项目的输入、预期输出、元数据。
4. 单击 **添加到数据集**。

## 编辑/存档数据集项目
您可以编辑或存档数据集项目。后续实验中会移除已存档项目。

### 使用 Python SDK
您可以通过提供要更新的项目`id`来更新项目。

```python
langfuse.create_dataset_item(
    id="<item_id>",
    # 示例：将状态更新为 "ARCHIVED"
    status="ARCHIVED"
)
```

### 使用 JS/TS SDK
```python
import { LangfuseClient } from "@langfuse/client";
 
const langfuse = new LangfuseClient();
 
await langfuse.api.datasetItems.create({
  id: "<item_id>",
  // 示例：将状态更新为 "ARCHIVED"
  status: "ARCHIVED",
});
```

### 使用控制台
在数据集项目列表中，您可以通过点击项目 ID 来编辑该项目。

要存档或删除该项目，请点击该项目旁边的![](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/powerrag/langfuse/icon7.png)图标，然后选择 **归档** 或 **删除**。

## 数据集跑测
创建数据集后，您可以基于数据集测试和评估您的应用。

+ [通过 SDK 跑测](/40.应用评估/20.跑测/20.通过%20SDK%20跑测.md)
+ [通过控制台跑测](/40.应用评估/20.跑测/30.通过控制台跑测.md)

